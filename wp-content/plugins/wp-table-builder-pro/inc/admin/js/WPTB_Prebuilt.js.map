{"version":3,"sources":["WPTB_Prebuilt.js"],"names":["prebuiltOwnContext","managerData","Object","assign","wptbPrebuiltData","undefined","PrebuiltManager","data","strings","markCounter","constants","prebuiltMarkData","prebuiltMarkOrder","tabStatus","tabIterator","currentEnv","getTable","document","querySelector","tableQuery","isDevBuild","isPrebuiltEnabled","dataset","wptbPrebuiltTable","prebuiltSaveCallback","e","detail","prebuilt","bindPrebuiltTools","addEventListener","getCounter","markElement","activeElement","target","parentNode","activeElem","markStatus","Number","parseInt","togglePrebuiltMarkIndicator","WPTB_TableStateSaveManager","tableStateSet","addMarkIndicator","el","markOrder","stringifiedMarkIndicator","range","createRange","setStart","markIndicator","createContextualFragment","appendChild","children","removeMarkIndicator","remove","addPrebuiltTools","actionsWrapper","stringifiedAction","markAction","removeAllMarkIndicators","Array","from","querySelectorAll","map","removeChild","removePrebuiltTools","removeEventListener","removePrebuiltDataSets","m","watch","enablePrebuilt","val","update","input","keys","k","prototype","hasOwnProperty","call","isEditingAlreadySavedTable","currentUrl","URL","window","location","href","searchParams","get","init","WPTB_ControlsManager","subscribe","security","devModeNonce","devTool","PrebuiltDevTool","teamBuildTablePrefix","addTools","addTabControl","builderWrapper","stringifiedTabControl","tabControl","icons","stopCircle","syncAlt","tabControlElement","controlStop","controlRestart","reset","tabTarget","iteratedObject","next","done","preventDefault","targetElement","value","click","focus","selection","getSelection","selectNodeContents","removeAllRanges","addRange","setUpTabTargeting","enabledElements","enabledElementsObject","Symbol","iterator","index","length","valueObject","key","setTimeout","nonce","teamBuildPrefix","isEditingTeamBuiltPrebuild","url","currentTableID","regexp","RegExp","matches","exec","storePrebuiltId","id","set","delete","history","pushState","toString","wrapperQuery","wrapper","strElement","devToolElement","childNodes","saveAsXMLButton","saveAsCSV","saveAsCSVNonce","prebuilt_id","Error","WPTB_Prebuilt"],"mappings":"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","file":"WPTB_Prebuilt.js","sourceRoot":"core/parcel-src","sourcesContent":["(function prebuiltOwnContext() {\n    // clone global prebuilt data\n    const managerData = Object.assign({}, wptbPrebuiltData);\n\n    // remove global data\n    wptbPrebuiltData = undefined;\n\n    /**\n     * Prebuilt table manager.\n     *\n     * Apart from generate menu, this manager will handle all prebuilt functionality after table is generated.\n     *\n     * @param {object} data data object\n     * @constructor\n     */\n    function PrebuiltManager(data) {\n        this.data = data;\n\n        this.strings = this.data.strings;\n\n        this.markCounter = 0;\n\n        // various constants for prebuilt manager use\n        this.constants = {\n            prebuiltMarkData: 'wptbPrebuiltMark',\n            prebuiltMarkOrder: 'wptbPrebuiltOrder',\n        }\n\n        this.tabStatus = true;\n\n        this.tabIterator = null;\n\n        // current environment type\n        const currentEnv = process.env.NODE_ENV;\n\n        /**\n         * Get current table on DOM.\n         *\n         * @return {HTMLElement} current table\n         */\n        this.getTable = () => {\n            return document.querySelector(this.data.tableQuery);\n        }\n\n        /**\n         * Get if current build is for development purposes or not\n         *\n         * @return {boolean} development build or not\n         */\n        this.isDevBuild = () => {\n            return currentEnv === 'development';\n        }\n\n        /**\n         * If current table marked as a prebuilt or not.\n         *\n         * @return {boolean} is prebuilt enabled or not\n         */\n        this.isPrebuiltEnabled = () => {\n            return this.getTable().dataset.wptbPrebuiltTable === '1';\n        }\n\n        /**\n         * Before save callback for prebuilt tables.\n         *\n         * @param {Event} e event\n         */\n        const prebuiltSaveCallback = (e) => {\n            e.detail.prebuilt = true;\n        }\n\n        /**\n         * Bind prebuilt tools to appropriate events.\n         */\n        this.bindPrebuiltTools = () => {\n            // removed for simplicity\n            // document.addEventListener('wptb:actionfield:generated', this.addPrebuiltTools);\n\n            // add before save callback for prebuilt enabled tables\n            document.addEventListener('wptb:save:before', prebuiltSaveCallback);\n        }\n\n        /**\n         * Get a unique counter number.\n         *\n         * @return {number} counter number\n         */\n        this.getCounter = () => {\n            return this.markCounter++;\n        }\n\n        /**\n         * Toggle hovered element's prebuilt status.\n         *\n         * @param {Event} e event\n         */\n        const markElement = (e) => {\n            const activeElement = e.target.parentNode.activeElem;\n\n            const markStatus = activeElement.dataset[this.constants.prebuiltMarkData];\n            if (markStatus === undefined) {\n                activeElement.dataset[this.constants.prebuiltMarkData] = 1;\n                activeElement.dataset[this.constants.prebuiltMarkOrder] = this.getCounter();\n            } else {\n                activeElement.dataset[this.constants.prebuiltMarkData] = (Number.parseInt(markStatus, 10) + 1) % 2;\n            }\n\n            togglePrebuiltMarkIndicator(activeElement);\n            new WPTB_TableStateSaveManager().tableStateSet();\n        }\n\n        /**\n         * Add a mark indicator to an element.\n         * @param {HTMLElement} el\n         */\n        const addMarkIndicator = (el) => {\n            const markOrder = el.dataset[this.constants.prebuiltMarkOrder];\n            const stringifiedMarkIndicator = `<div class=\"wptb-prebuilt-mark-indicator\" data-wptb-prebuilt-indicator-order=\"${markOrder}\"></div>`;\n\n            const range = document.createRange();\n            range.setStart(document, 0);\n            const markIndicator = range.createContextualFragment(stringifiedMarkIndicator);\n\n            el.appendChild(markIndicator.children[0]);\n        }\n\n        /**\n         * Remove a mark indicator attached to current element.\n         * @param {HTMLElement} el main element\n         */\n        const removeMarkIndicator = (el) => {\n            const markOrder = el.dataset[this.constants.prebuiltMarkOrder];\n            const markIndicator = el.querySelector(`.wptb-prebuilt-mark-indicator[data-wptb-prebuilt-indicator-order=\"${markOrder}\"]`);\n\n            if (markIndicator) {\n                markIndicator.remove();\n            }\n        }\n\n        /**\n         * Toggle prebuilt mark indicator bind to prebuilt element.\n         *\n         * @param {HTMLElement} el\n         */\n        const togglePrebuiltMarkIndicator = (el) => {\n            const markStatus = Number.parseInt(el.dataset[this.constants.prebuiltMarkData], 10);\n\n            if (markStatus) {\n                addMarkIndicator(el);\n            } else {\n                removeMarkIndicator(el);\n            }\n        }\n\n        /**\n         * Add necessary tools and logic to builder to work on prebuilt.\n         */\n        this.addPrebuiltTools = () => {\n            const actionsWrapper = document.querySelector('.wptb-actions');\n\n            const stringifiedAction = '<span title=\"mark element as prebuilt target\" class=\"dashicons dashicons-media-spreadsheet wptb-prebuilt-mark-action\"></span>'\n            const range = document.createRange();\n            range.setStart(actionsWrapper, 0);\n            const markAction = range.createContextualFragment(stringifiedAction);\n\n            markAction.children[0].addEventListener('click', markElement);\n\n            actionsWrapper.appendChild(markAction);\n        }\n\n        /**\n         * Remove all prebuilt mark indicators from table.\n         */\n        const removeAllMarkIndicators = () => {\n            Array.from(document.querySelectorAll('.wptb-prebuilt-mark-indicator')).map(e => {\n                e.parentNode.removeChild(e);\n            });\n        }\n\n        /**\n         * Remove prebuilt related tools/events/hooks from table and builder.\n         */\n        this.removePrebuiltTools = () => {\n            // removed for simplicity\n            // remove prebuilt mark button from actions\n            // document.removeEventListener('wptb:actionfield:generated', this.addPrebuiltTools);\n\n            // remove before save event listener for prebuilt tables\n            document.removeEventListener('wptb:save:before', prebuiltSaveCallback);\n\n            // remove for simplicity\n            // remove prebuilt mark indicators\n            // removeAllMarkIndicators();\n        }\n\n        /**\n         * Remove prebuilt data sets from table.\n         */\n        const removePrebuiltDataSets = () => {\n            Array.from(document.querySelectorAll('[data-wptb-prebuilt-mark]')).map(m => {\n                delete m.dataset[this.constants.prebuiltMarkData];\n            });\n        }\n\n        /**\n         * Watch list.\n         *\n         * @type {object}\n         */\n        const watch = {\n            enablePrebuilt: function (val) {\n                if (val === 'checked') {\n                    this.bindPrebuiltTools();\n                } else {\n                    this.removePrebuiltTools();\n                    removePrebuiltDataSets();\n                }\n            }\n        }\n\n        /**\n         * Update hook for prebuilt instance.\n         *\n         * Changes to table settings will be observed and appropriate actions will take.\n         * Also if any of the input key is being watched with watch list, it will be called to handle the change at the value.\n         * @param {object} input\n         */\n        this.update = (input) => {\n            Object.keys(input).map(k => {\n                if (Object.prototype.hasOwnProperty.call(input, k)) {\n                    if (watch[k] && typeof watch[k] === 'function') {\n                        watch[k].call(this, input[k]);\n                    }\n                }\n            })\n        }\n\n        /**\n         * Editing an already saved table or not.\n         *\n         * @return {boolean} editing or not\n         */\n        const isEditingAlreadySavedTable = () => {\n            const currentUrl = new URL(window.location.href);\n\n            return currentUrl.searchParams.get('table') !== null;\n        }\n\n        /**\n         * Initialization hook of prebuilt instance.\n         */\n        this.init = () => {\n            if (this.isPrebuiltEnabled()) {\n                //bind and setup prebuilt mark tools for builder\n                this.bindPrebuiltTools();\n            } else {\n                this.removePrebuiltTools();\n                if (!isEditingAlreadySavedTable()) {\n                    // removed for simplicity\n                    // this.setUpTabTargeting();\n                }\n            }\n\n            // @deprecated\n            // bind table control value changes to update hook\n            // WPTB_Helper.controlsInclude(this.getTable(), this.update, true);\n\n            // subscribe to table setting updates\n            WPTB_ControlsManager.subscribe('prebuilt', this.update)\n\n            // dev tool implementation\n            if (!this.isDevBuild()) {\n                // remove dev mode nonce value is current build is not a development one\n                this.data.security.devModeNonce = undefined;\n            } else {\n                this.devTool = new PrebuiltDevTool(this.data.security.devModeNonce, this.data.teamBuildTablePrefix);\n                this.devTool.addTools('.wptb-builder-content');\n            }\n        }\n\n        /**\n         * Add tab control element to page.\n         */\n        const addTabControl = () => {\n            const builderWrapper = document.querySelector('.wptb-builder-content');\n\n            const stringifiedTabControl = `<div class=\"wptb-prebuilt-tab-control\"><div class=\"wptb-prebuilt-tab-control-label\">${this.strings.tabControl}</div><div class=\"wptb-prebuilt-tab-control-buttons-wrapper\"><div class=\"wptb-prebuilt-tab-control-icon wptb-plugin-filter-box-shadow-md-close\" data-wptb-prebuilt-tab-control-type=\"stop\">${this.data.icons.stopCircle}</div><div class=\"wptb-prebuilt-tab-control-icon wptb-plugin-filter-box-shadow-md-close\" data-wptb-prebuilt-tab-control-type=\"restart\">${this.data.icons.syncAlt}</div></div></div>`;\n            const range = document.createRange();\n            range.setStart(document, 0);\n            const tabControlElement = range.createContextualFragment(stringifiedTabControl);\n\n            builderWrapper.appendChild(tabControlElement.children[0]);\n\n            const controlStop = document.querySelector('.wptb-prebuilt-tab-control-icon[data-wptb-prebuilt-tab-control-type=\"stop\"]');\n\n            const controlRestart = document.querySelector('.wptb-prebuilt-tab-control-icon[data-wptb-prebuilt-tab-control-type=\"restart\"]');\n\n            controlStop.addEventListener('click', () => {\n                removeAllMarkIndicators();\n                this.tabStatus = false;\n            })\n\n            controlRestart.addEventListener('click', () => {\n                if (this.tabIterator) {\n                    removeAllMarkIndicators()\n                    this.tabIterator.reset();\n                    this.tabStatus = true;\n                    tabTarget();\n                }\n            })\n        }\n\n\n        /**\n         * Tab focus an element.\n         *\n         * @param {HTMLElement} e element to focus\n         */\n        const tabTarget = (e) => {\n            if (this.tabIterator) {\n                const iteratedObject = this.tabIterator.next();\n                removeAllMarkIndicators();\n                if (!iteratedObject.done) {\n                    if (e) {\n                        e.preventDefault();\n                    }\n                    const targetElement = iteratedObject.value;\n                    addMarkIndicator(targetElement);\n                    targetElement.click();\n                    targetElement.click();\n                    targetElement.focus();\n\n                    // highlight and select text content of element\n                    const selection = window.getSelection();\n                    const range = document.createRange();\n                    range.selectNodeContents(targetElement);\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                } else {\n                    this.tabStatus = false;\n                }\n            }\n        }\n\n        /**\n         * Setup tab targeting for prebuilt marked elements.\n         */\n        this.setUpTabTargeting = () => {\n            const enabledElements = Array.from(document.querySelectorAll('.wptb-table-setup [data-wptb-prebuilt-mark = \"1\"]'));\n\n            const enabledElementsObject = (() => {\n                return {\n                    [Symbol.iterator]: () => {\n                        let index = 0;\n                        const length = enabledElements.length;\n\n                        const next = () => {\n                            let valueObject = {value: undefined, done: true};\n                            if (index < length) {\n                                valueObject = {value: enabledElements[index], done: false}\n                            }\n\n                            index = index + 1 >= length ? length : index + 1;\n\n                            return valueObject;\n                        }\n                        const reset = () => {\n                            index = 0;\n                        }\n                        return {next, reset};\n                    }\n                }\n            })();\n\n            if (enabledElements.length > 0) {\n                addTabControl();\n            }\n\n            this.tabIterator = enabledElementsObject[Symbol.iterator]();\n\n            // bind tab targeting to keyboard event\n            if (enabledElements.length > 0) {\n                document.addEventListener('keyup', (e) => {\n                    if (e.key === 'Tab' && this.tabStatus) {\n                        tabTarget(e);\n                    }\n                });\n            }\n\n            // workaround for underscore error\n            setTimeout(() => {\n                tabTarget();\n            }, 1000);\n\n        }\n    }\n\n\n    /**\n     * Prebuilt development tool.\n     *\n     * @param {string} nonce security nonce for dev tool operations\n     * @param {string} teamBuildPrefix id prefix for team built tables\n     * @constructor\n     */\n    function PrebuiltDevTool(nonce, teamBuildPrefix) {\n        /**\n         * Is editing a team built prebuild table.\n         */\n        const isEditingTeamBuiltPrebuild = () => {\n            const url = new URL(window.location.href);\n            const currentTableID = url.searchParams.get('table');\n\n            if (currentTableID !== null) {\n                const regexp = new RegExp(`^${teamBuildPrefix}_(.+)$`, 'g');\n                const matches = regexp.exec(currentTableID);\n\n                if (matches) {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n        const storePrebuiltId = () => {\n            const url = new URL(window.location.href);\n            if (isEditingTeamBuiltPrebuild()) {\n                const id = url.searchParams.get('table');\n                url.searchParams.set('prebuilt_id', id);\n\n            }\n            url.searchParams.delete('table');\n            window.history.pushState(null, null, url.toString());\n        }\n\n        /**\n         * Add dev tool to DOM\n         *\n         * @param {string} wrapperQuery query for wrapper element\n         */\n        this.addTools = (wrapperQuery) => {\n            const wrapper = document.querySelector(wrapperQuery);\n\n            if (wrapper) {\n                const strElement = '<div class=\"wptb-prebuilt-dev-tool\"><div class=\"label\">Dev Tools</div><div class=\"prebuilt-button\" data-prebuilt-button=\"saveAsCSV\" >Append to file</div></div>'\n                const range = document.createRange();\n                range.setStart(wrapper, 0);\n                const devToolElement = range.createContextualFragment(strElement).childNodes[0];\n\n                wrapper.appendChild(devToolElement);\n\n                const saveAsXMLButton = wrapper.querySelector('[data-prebuilt-button=\"saveAsCSV\"]');\n\n                function saveAsCSV({detail}) {\n                    detail.prebuilt = true;\n                    detail.saveAsCSV = true;\n                    detail.saveAsCSVNonce = nonce;\n\n                    const url = new URL(window.location.href);\n                    const prebuilt_id = url.searchParams.get('prebuilt_id');\n\n                    if (prebuilt_id) {\n                        detail.prebuilt_id = prebuilt_id;\n                        url.searchParams.delete('prebuilt_id');\n                        window.history.pushState(null, null, url.toString());\n                    }\n                }\n\n                saveAsXMLButton.addEventListener('click', (e) => {\n                    e.preventDefault();\n\n                    document.addEventListener('wptb:save:before', saveAsCSV);\n\n                    storePrebuiltId();\n\n                    // trigger save event\n                    new WPTB_TableStateSaveManager().tableStateSet();\n                    document.querySelector('.wptb-save-btn').click();\n\n                    document.removeEventListener('wptb:save:before', saveAsCSV);\n                })\n\n            } else {\n                throw new Error(`[WPTB-Prebuilt_Dev_Tools]: no valid wrapper element found with the given query of ${wrapperQuery}`);\n            }\n        }\n    }\n\n    const WPTB_Prebuilt = new PrebuiltManager(managerData)\n\n// initialize prebuilt instance when table is generated\n    document.addEventListener('wptb:table:generated', () => {\n        WPTB_Prebuilt.init()\n    })\n})();\n"]}